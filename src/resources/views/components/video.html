<html>

<head>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-primary: #032336bd;
            --color-secondary: #ffc629;
            --color-accent: #3bc9db;
            --color-dark-blue: #29425f;

            --video-bg: #000;
            --video-player-main: var(--color-secondary);
            --video-overlay-bg: rgba(0, 0, 0, 0.6);
            --video-shadow-medium: rgba(0, 0, 0, 0.4);
            --video-shadow-strong: rgba(0, 0, 0, 0.6);
        }

        .video-container {
            position: relative;
            width: 100%;
            height: auto;
            min-height: 200px;
            max-height: 100vh;
            background-color: transparent;
            overflow: hidden;
            box-shadow: 0 8px 32px var(--video-shadow-medium);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
            aspect-ratio: 10 / 6;

            --plyr-color-main: var(--video-player-main);
            --plyr-video-background: var(--video-bg);
        }

        .video-overlay-left {
            background: red;
            width: 43%;
            height: 80%;
            position: absolute;
            z-index: 10;
            top: 2%;
            left: 2%;
        }

        .video-overlay-right {
            background: red;
            width: 43%;
            height: 80%;
            position: absolute;
            z-index: 10;
            top: 2%;
            right: 2%;
        }

        @media (max-width: 991px) {
            .video-container {
                aspect-ratio: 13 / 9;
            }
        }

        @media (max-width: 576px) {
            .video-container {
                aspect-ratio: 7 / 10;
            }
        }


        .plyr__controls .plyr__controls__item:first-child {
            margin-left: auto !important;
            margin-right: 0 !important;
        }

        .plyr__controls button.plyr__controls__item {
            position: absolute !important;
            left: 2px;
        }

        .plyr__controls .plyr__controls__item:last-child {
            position: relative !important;
        }

        .plyr__progress__container {
            position: absolute;
            width: 98%;
            top: 10px;
        }

        .video-container video {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: contain !important;
            display: block;
        }

        .video-loading-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--video-overlay-bg);
            z-index: 10;
        }

        .video-loading-overlay .spinner {
            width: 44px;
            height: 44px;
            border: 3px solid rgba(255, 255, 255, 0.25);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: cd-spin 1s linear infinite;
        }

        @keyframes cd-spin {
            to {
                transform: rotate(360deg);
            }
        }

        .plyr {
            height: 100%;
        }

        .plyr__controls {
            padding-inline: 10px;
        }

        .plyr__control--overlaid {
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            margin: 0 !important;
            background: var(--color-primary) !important;
            color: #fff !important;
            border-radius: 50% !important;
        }

        .plyr__controls__item.plyr__progress__container {
            position: absolute;
            top: 16px;
            width: 98%;
        }

        .plyr__controls .plyr__control[data-plyr="rewind"] {
            position: absolute !important;
            left: 10px !important;
        }

        .plyr__controls .plyr__control[data-plyr="play"] {
            position: absolute !important;
            left: 50px !important;
        }

        .plyr__controls .plyr__control[data-plyr="fast-forward"] {
            position: absolute !important;
            left: 90px !important;
        }

        .plyr__controls .plyr__time--current {
            position: absolute !important;
            left: 135px !important;
            bottom: 12px !important;

        }

        .plyr__controls .plyr__time--duration {
            position: absolute !important;
            left: 178px !important;
            bottom: 12px !important;

        }

        @media (max-width: 600px) {
            .plyr__controls__item.plyr__time--current.plyr__time {
                bottom: 9px !important;

            }

            .plyr__controls__item.plyr__progress__container {

                top: 1px !important;
            }

            .plyr__controls .plyr__control[data-plyr="play"] {
                left: 33px !important;
            }

            .plyr__controls .plyr__control[data-plyr="fast-forward"] {
                left: 55px !important;
            }

            .plyr__controls .plyr__time--current {
                left: 85px !important;
            }

            .plyr__controls .plyr__time--duration {
                left: 130px !important;
            }
        }
    </style>

</head>

<body>

    <div class="video-container">

        <video id="player" playsinline controls poster="THUMB_URL" class="plyr">
            <source src="VIDEO_LINK" type="application/x-mpegURL" />
        </video>
        <div class="video-loading-overlay" id="video-loader">
            <div class="spinner"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

    <script>
        function videoPlayerIoRun(source = null) {
            const video = document.getElementById("player");

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(source ?? video.querySelector("source").src);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, function () {


                    const availableQualities = hls.levels
                        .map(l => l.height)
                        .filter((v, i, a) => a.indexOf(v) === i)
                        .sort((a, b) => b - a);

                    initPlyr(availableQualities, hls);
                });
                // safari support 
            } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
                video.addEventListener("loadedmetadata", () => {
                    initPlyr([], null);
                });
            }

            // const player = new Plyr(video);
        }

        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        function initPlyr(availableQualities, hls) {
            const video = document.getElementById("player");
            const loader = document.getElementById("video-loader");
            const isIos = isIOS();
            const i18n_ar = {
                restart: "إعادة التشغيل",
                rewind: "رجوع 10 ثواني",
                play: "تشغيل",
                pause: "إيقاف مؤقت",
                fastForward: "تقديم 10 ثواني",
                seek: "تخطي",
                seekLabel: "{seektime} ثانية",
                played: "تم التشغيل",
                buffered: "تم التحميل المؤقت",
                currentTime: "الوقت الحالي",
                duration: "المدة",
                volume: "الصوت",
                mute: "كتم الصوت",
                unmute: "إلغاء الكتم",
                enableCaptions: "تشغيل الترجمة",
                disableCaptions: "إيقاف الترجمة",
                download: "تحميل",
                enterFullscreen: "ملء الشاشة",
                exitFullscreen: "الخروج من ملء الشاشة",
                frameTitle: "مشغل للفيديو",
                captions: "الترجمة",
                settings: "الإعدادات",
                menuBack: "رجوع",
                speed: "السرعة",
                normal: "عادي",
                quality: "الجودة",
                loop: "تشغيل متكرر",
            };

            const controls = isIos ? [
                "play-large",
                "rewind",
                "play",
                "fast-forward",
                "progress",
                "current-time",
                "duration",
                "mute",
                "volume",
                "settings"

            ] : [
                "play-large",
                "rewind",
                "play",
                "fast-forward",
                "progress",
                "current-time",
                "duration",
                "mute",
                "volume",
                "settings"
            ];

            const player = new Plyr(video, {
                i18n: i18n_ar,
                controls: controls,
                settings: ["quality", "speed", "captions"],
                tooltips: {
                    controls: true,
                    seek: true
                },
                quality: {
                    default: availableQualities[0] || 720,
                    options: availableQualities,
                    forced: true,
                    onChange: newQuality => {
                        if (hls) {
                            const level = hls.levels.findIndex(l => l.height === newQuality);
                            if (level !== -1) {
                                hls.currentLevel = level;
                            }
                        }
                    }
                }
            });

            if (isIos) {
                video.removeAttribute("playsinline");
            }

            video.addEventListener("canplay", () => {
                loader.style.display = "none";
            }, {
                once: true
            });

            document.querySelector('.plyr').style.height = "95%";
            document.addEventListener('dblclick', function (event) {
                player.fullscreen.exit();
            });
            player.on('enterfullscreen', () => {
                if (player.fullscreen.active) {
                    player.fullscreen.exit();
                }
            });
            player.on('play', function () {
                PlayerState.postMessage('Playing');
            });

            player.on('pause', function () {
                PlayerState.postMessage('Paused');
            });
            player.on('controlsshown', (event) => {
                Controls.postMessage('controlsshown');
            });
            player.on('controlshidden', (event) => {
                Controls.postMessage('controlshidden');
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
            videoPlayerIoRun();
        });
    </script>

</body>

</html>